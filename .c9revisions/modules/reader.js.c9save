{"ts":1363955152147,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var feedparser = require('feedparser')\n    , mongoose = require('mongoose')\n    , schema   = require('./schema');\n    \nmongoose.connect('mongodb://localhost/rssreader');\n\nfunction Reader(){\n}\n\nReader.test = function(){\n  console.log('aaa');  \n};\n\nReader.read = function(){\n    feedparser.parseUrl('feeds.gawker.com/gizmodo/full',\n        function(error, meta, articles){\n            if(error) console.error(error);\n            else{\n                console.log('%s - %s - %s', meta.title, meta.link, meta.xmlUrl);\n                articles.forEach(function(article){\n                    console.log(\"%s - %s(%s)\", article.date, article.title, article.link);\n                });\n            }\n        });\n};\n\nReader.save = function(name){\n    var db = mongoose.connection;\n    db.on('error', console.error.bind(console, 'connection error:'));\n    db.once('open', function(){\n        var Feed = mongoose.model('Feed');\n        var feed = new Feed({name: name});\n        feed.save(function(){\n            console.log('success');\n        });\n    });\n};\n\nReader.load = function(callback){\n    console.log(\"Call Reader.load\");\n    var Feed = mongoose.model('Feed');\n    Feed.find(function(err, feeds){\n        callback(feeds);\n    });\n};\n\nReader.addFeed = function(url, callback){\n    feedparser.parseUrl(url,\n        function(error, meta, articles){\n            if(error) console.error(error);\n            else{\n                var Feed = mongoose.model('Feed');\n                var feed = new Feed({\n                    name: meta.title,\n                    link: meta.link,\n                    xmlUrl: meta.xmlUrl\n                });\n                \n                console.log('Add feed. %s - %s - %s', meta.title, meta.link, meta.xmlUrl);\n                \n                feed.save(function(){\n                    console.log('Success to save feed.');\n                    callback(feed);\n                });\n            }\n        });\n};\n\nReader.getFeedArticles = function(url, callback){\n    feedparser.parseUrl(url,\n        function(error, meta, articles){\n            if(error) console.error(error);\n            else callback(articles);\n        });\n};\n\nexports = module.exports = Reader;"]],"start1":0,"start2":0,"length1":0,"length2":2188}]],"length":2188}
{"contributors":[],"silentsave":false,"ts":1363956323693,"patch":[[{"diffs":[[0,"               \n"],[1,"                articles.forEach(function(article){\n                    feed.item.push(article);\n                });\n                \n"],[0,"                "]],"start1":1631,"start2":1631,"length1":32,"length2":166}]],"length":2322,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364030166555,"patch":[[{"diffs":[[0," Feed({\n"],[1,"                    _id: new mongoose.Types.ObjectId,\n"],[0,"        "]],"start1":1487,"start2":1487,"length1":16,"length2":70},{"diffs":[[0,"a.xmlUrl"],[1," !== null ? meta.xmlUrl : url"],[0,"\n       "]],"start1":1655,"start2":1655,"length1":16,"length2":45},{"diffs":[[0,"    "],[-1,"articles.forEach(function(article){\n                    feed.item.push("],[1,"console.log('Add feed. %s - %s - %s', meta.title, meta.link, meta.xmlUrl);\n                \n                feed.save(function(err, f){\n                    if(err) console.error(err);\n                    else{\n                        console.log('Success to save feed.');\n                        callback(f, "],[0,"article"],[1,"s"],[0,");\n "]],"start1":1742,"start2":1742,"length1":86,"length2":324},{"diffs":[[0,"                "],[-1,"});"],[1,"    }"],[0,"\n               "]],"start1":2065,"start2":2065,"length1":35,"length2":37},{"diffs":[[0,"                "],[1,"});"],[0,"\n               "]],"start1":2087,"start2":2087,"length1":32,"length2":35},{"diffs":[[0,"    "],[-1,"    console.log('Add feed. %s - %s - %s', meta.title, meta.link, meta.xmlUrl);\n                \n                feed.save(function(){"],[1,"}\n        });\n};\n\nReader.addArticles = function(feed, articles, callback){\n    console.log('reader.js:Reader.addArticles:');\n    articles.forEach(function(article){\n        var Article = mongoose.model('Article');\n        var a = new Article({\n            feedId:         feed._id,\n            date:           article.date,"],[0,"\n   "]],"start1":2115,"start2":2115,"length1":141,"length2":331},{"diffs":[[0,"date,\n          "],[1,"  title:"],[0,"          consol"]],"start1":2437,"start2":2437,"length1":32,"length2":40},{"diffs":[[0,"    "],[-1,"console.log('Success to save feed.');\n                    callback(feed"],[1,"article.title,\n            description:    article.description,\n            summary:        article.summary,\n            link:           article.link\n        }"],[0,");\n "]],"start1":2467,"start2":2467,"length1":79,"length2":167},{"diffs":[[0,"    "],[1,"\n"],[0,"        "],[-1,"});\n            }\n        }"],[1,"a.save();\n    });\n};\n\nReader.getFeedArticles = function(feedId, callback){\n    console.log('reader.js:Reader.getFeedArticles:feedId=%s', feedId);\n    var Article = mongoose.model('Article');\n    Article.find({feedId: new mongoose.Types.ObjectId(feedId)}, callback"],[0,");\n}"]],"start1":2637,"start2":2637,"length1":43,"length2":280},{"diffs":[[0,";\n};\n\nReader.get"],[-1,"Feed"],[1,"New"],[0,"Articles = funct"]],"start1":2914,"start2":2914,"length1":36,"length2":35},{"diffs":[[0,"  });\n};"],[-1,""],[1,"\n\n"],[0,"\n\nexport"]],"start1":3126,"start2":3126,"length1":16,"length2":18}]],"length":3172,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364394591573,"patch":[[{"diffs":[[0,"les:');\n    "],[-1,""],[0,""],[1,"var arr;\n    "],[0,"articles.for"]],"start1":2236,"start2":2236,"length1":24,"length2":37},{"diffs":[[0," a.save("],[-1,");\n    }"],[1,"function(err, a){\n            if(err) console.error(err);\n            else arr.push(a);\n        });\n    });\n    callback(arr"],[0,");\n};\n\nR"]],"start1":2662,"start2":2662,"length1":24,"length2":140},{"diffs":[[0,"cles = function("],[-1,"url"],[1,"feedId"],[0,", callback){\n   "]],"start1":3066,"start2":3066,"length1":35,"length2":38},{"diffs":[[0,"    "],[-1,"feedparser.parseUrl(url,\n        function(error, meta, articles){\n            if(error) console.error(error);"],[1,"var Feed = mongoose.model('Feed');\n    Feed.findOne({feedId: new mongoose.Types.ObjectId(feedId)}, function(err, feed){\n        if(feed.xmlUrl !== null)\n            feedparser.parseUrl(feed.xmlUrl, function(err, meta, articles){"],[0,"\n   "]],"start1":3101,"start2":3101,"length1":117,"length2":236},{"diffs":[[0,"        "],[-1,"else"],[1,"   "],[0," callbac"]],"start1":3338,"start2":3338,"length1":20,"length2":19},{"diffs":[[0,"allback("],[1,"err, meta, "],[0,"articles"],[1,", feed"],[0,");\n    "],[1,"        });\n"],[0,"    });\n"]],"start1":3351,"start2":3351,"length1":31,"length2":60}]],"length":3451,"saved":false}
{"ts":1364394629525,"patch":[[{"diffs":[[0," feed){\n"],[1,"        if(err) throw err;\n"],[0,"        "]],"start1":3217,"start2":3217,"length1":16,"length2":43}]],"length":3478,"saved":false}
{"ts":1364394675419,"patch":[[{"diffs":[[0,"    "],[-1,"if(err) throw err"],[1,"console.log(feed)"],[0,";\n  "]],"start1":3229,"start2":3229,"length1":25,"length2":25}]],"length":3478,"saved":false}
{"ts":1364394766985,"patch":[[{"diffs":[[0,".model('Feed');\n"],[1,"    Feed.findById();\n    \n    \n"],[0,"    Feed.findOne"]],"start1":3124,"start2":3124,"length1":32,"length2":63}]],"length":3509,"saved":false}
{"ts":1364394788423,"patch":[[{"diffs":[[0,"indById("],[1,"new mongoose.Types.ObjectId(feedId), function(err, feed){\n        \n    }"],[0,");\n    \n"]],"start1":3150,"start2":3150,"length1":16,"length2":88}]],"length":3581,"saved":false}
{"ts":1364394797365,"patch":[[{"diffs":[[0,"d){\n"],[-1,"        \n    });\n    \n    \n    Feed.findOne({feedId: new mongoose.Types.ObjectId(feedId)}, function(err, feed){\n"],[0,"    "]],"start1":3212,"start2":3212,"length1":120,"length2":8}]],"length":3469,"saved":false}
{"ts":1364394838776,"patch":[[{"diffs":[[0," var arr"],[1," = new Array()"],[0,";\n    ar"]],"start1":2247,"start2":2247,"length1":16,"length2":30}]],"length":3483,"saved":false}
{"ts":1364395039234,"patch":[[{"diffs":[[0,"feedId)}"],[-1,", "],[1,")\n            .sort({date: 'desc'})\n            .exec("],[0,"callback"]],"start1":3038,"start2":3038,"length1":18,"length2":70}]],"length":3535,"saved":false}
{"ts":1364396462055,"patch":[[{"diffs":[[0,"desc'})\n"],[1,"            .limit(3)\n"],[0,"        "]],"start1":3074,"start2":3074,"length1":16,"length2":38}]],"length":3557,"saved":false}
{"ts":1364396480703,"patch":[[{"diffs":[[0,"'})\n"],[-1,"            .limit(3)\n"],[0,"    "]],"start1":3078,"start2":3078,"length1":30,"length2":8}]],"length":3535,"saved":false}
{"ts":1364396554371,"patch":[[{"diffs":[[0,"rticles:');\n"],[1,"    console.log('articles.length:%s', articles.length);\n"],[0,"    var arr "]],"start1":2232,"start2":2232,"length1":24,"length2":80}]],"length":3591,"saved":false}
{"ts":1364397323892,"patch":[[{"diffs":[[0,"a){\n"],[-1,"            if(err) console.error(err);\n            else arr.push(a);\n"],[0,"    "]],"start1":2754,"start2":2754,"length1":78,"length2":8}]],"length":3521,"saved":false}
{"ts":1364397434058,"patch":[[{"diffs":[[0,"     a.save("],[1,");\n    },"],[0,"function(err"]],"start1":2728,"start2":2728,"length1":24,"length2":33},{"diffs":[[0,"(err"],[-1,", a"],[0,"){\n    "],[-1,"    });\n    });\n"],[0,"    "]],"start1":2757,"start2":2757,"length1":34,"length2":15},{"diffs":[[0,"ack(arr)"],[1,"\n    })"],[0,";\n};\n\nRe"]],"start1":2777,"start2":2777,"length1":16,"length2":23}]],"length":3518,"saved":false}
{"ts":1364397552558,"patch":[[{"diffs":[[0,"ack(arr)"],[1,";"],[0,"\n    });"]],"start1":2777,"start2":2777,"length1":16,"length2":17}]],"length":3519,"saved":false}
{"ts":1364397635507,"patch":[[{"diffs":[[0," a.save("],[1,"function(err, a){\n            if(err) console.error(err);\n            else arr.push(a);\n        }"],[0,");\n    }"]],"start1":2732,"start2":2732,"length1":16,"length2":113},{"diffs":[[0,";\n    },"],[1," "],[0,"function"]],"start1":2838,"start2":2838,"length1":16,"length2":17}]],"length":3617,"saved":false}
{"ts":1364398283438,"patch":[[{"diffs":[[0,"});\n"],[-1,"    }, function(err){\n        callback(arr);\n"],[0,"    "]],"start1":2836,"start2":2836,"length1":53,"length2":8}]],"length":3572,"saved":false}
{"ts":1364398299651,"patch":[[{"diffs":[[0,"rray();\n"],[1,"    var endCount = 0;\n"],[0,"    arti"]],"start1":2319,"start2":2319,"length1":16,"length2":38}]],"length":3594,"saved":false}
{"ts":1364398322499,"patch":[[{"diffs":[[0,"else"],[-1," arr.push(a);"],[1,"{\n                arr.push(a);\n                endCount++;\n            }"],[0,"\n   "]],"start1":2832,"start2":2832,"length1":21,"length2":80}]],"length":3653,"saved":false}
{"ts":1364398357692,"patch":[[{"diffs":[[0,"ount++;\n"],[1,"                if(endCount == articles.length)\n                    callback(arr);\n"],[0,"        "]],"start1":2887,"start2":2887,"length1":16,"length2":99}]],"length":3736,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364399579582,"patch":[[{"diffs":[[0,"function(feedId,"],[1," limit,"],[0," callback){\n    "]],"start1":3041,"start2":3041,"length1":32,"length2":39}]],"length":3743,"saved":false}
{"ts":1364399736327,"patch":[[{"diffs":[[0,"', feedId);\n"],[1,"    if('number' != typeof limit){\n        limit = 30;\n    }\n"],[0,"    var Arti"]],"start1":3135,"start2":3135,"length1":24,"length2":84}]],"length":3803,"saved":false}
{"ts":1364399750929,"patch":[[{"diffs":[[0,"desc'})\n"],[1,"            .limit(limit)\n"],[0,"        "]],"start1":3342,"start2":3342,"length1":16,"length2":42}]],"length":3829,"saved":false}
