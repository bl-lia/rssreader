{"ts":1363955152147,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var feedparser = require('feedparser')\n    , mongoose = require('mongoose')\n    , schema   = require('./schema');\n    \nmongoose.connect('mongodb://localhost/rssreader');\n\nfunction Reader(){\n}\n\nReader.test = function(){\n  console.log('aaa');  \n};\n\nReader.read = function(){\n    feedparser.parseUrl('feeds.gawker.com/gizmodo/full',\n        function(error, meta, articles){\n            if(error) console.error(error);\n            else{\n                console.log('%s - %s - %s', meta.title, meta.link, meta.xmlUrl);\n                articles.forEach(function(article){\n                    console.log(\"%s - %s(%s)\", article.date, article.title, article.link);\n                });\n            }\n        });\n};\n\nReader.save = function(name){\n    var db = mongoose.connection;\n    db.on('error', console.error.bind(console, 'connection error:'));\n    db.once('open', function(){\n        var Feed = mongoose.model('Feed');\n        var feed = new Feed({name: name});\n        feed.save(function(){\n            console.log('success');\n        });\n    });\n};\n\nReader.load = function(callback){\n    console.log(\"Call Reader.load\");\n    var Feed = mongoose.model('Feed');\n    Feed.find(function(err, feeds){\n        callback(feeds);\n    });\n};\n\nReader.addFeed = function(url, callback){\n    feedparser.parseUrl(url,\n        function(error, meta, articles){\n            if(error) console.error(error);\n            else{\n                var Feed = mongoose.model('Feed');\n                var feed = new Feed({\n                    name: meta.title,\n                    link: meta.link,\n                    xmlUrl: meta.xmlUrl\n                });\n                \n                console.log('Add feed. %s - %s - %s', meta.title, meta.link, meta.xmlUrl);\n                \n                feed.save(function(){\n                    console.log('Success to save feed.');\n                    callback(feed);\n                });\n            }\n        });\n};\n\nReader.getFeedArticles = function(url, callback){\n    feedparser.parseUrl(url,\n        function(error, meta, articles){\n            if(error) console.error(error);\n            else callback(articles);\n        });\n};\n\nexports = module.exports = Reader;"]],"start1":0,"start2":0,"length1":0,"length2":2188}]],"length":2188}
{"contributors":[],"silentsave":false,"ts":1363956323693,"patch":[[{"diffs":[[0,"               \n"],[1,"                articles.forEach(function(article){\n                    feed.item.push(article);\n                });\n                \n"],[0,"                "]],"start1":1631,"start2":1631,"length1":32,"length2":166}]],"length":2322,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364030166555,"patch":[[{"diffs":[[0," Feed({\n"],[1,"                    _id: new mongoose.Types.ObjectId,\n"],[0,"        "]],"start1":1487,"start2":1487,"length1":16,"length2":70},{"diffs":[[0,"a.xmlUrl"],[1," !== null ? meta.xmlUrl : url"],[0,"\n       "]],"start1":1655,"start2":1655,"length1":16,"length2":45},{"diffs":[[0,"    "],[-1,"articles.forEach(function(article){\n                    feed.item.push("],[1,"console.log('Add feed. %s - %s - %s', meta.title, meta.link, meta.xmlUrl);\n                \n                feed.save(function(err, f){\n                    if(err) console.error(err);\n                    else{\n                        console.log('Success to save feed.');\n                        callback(f, "],[0,"article"],[1,"s"],[0,");\n "]],"start1":1742,"start2":1742,"length1":86,"length2":324},{"diffs":[[0,"                "],[-1,"});"],[1,"    }"],[0,"\n               "]],"start1":2065,"start2":2065,"length1":35,"length2":37},{"diffs":[[0,"                "],[1,"});"],[0,"\n               "]],"start1":2087,"start2":2087,"length1":32,"length2":35},{"diffs":[[0,"    "],[-1,"    console.log('Add feed. %s - %s - %s', meta.title, meta.link, meta.xmlUrl);\n                \n                feed.save(function(){"],[1,"}\n        });\n};\n\nReader.addArticles = function(feed, articles, callback){\n    console.log('reader.js:Reader.addArticles:');\n    articles.forEach(function(article){\n        var Article = mongoose.model('Article');\n        var a = new Article({\n            feedId:         feed._id,\n            date:           article.date,"],[0,"\n   "]],"start1":2115,"start2":2115,"length1":141,"length2":331},{"diffs":[[0,"date,\n          "],[1,"  title:"],[0,"          consol"]],"start1":2437,"start2":2437,"length1":32,"length2":40},{"diffs":[[0,"    "],[-1,"console.log('Success to save feed.');\n                    callback(feed"],[1,"article.title,\n            description:    article.description,\n            summary:        article.summary,\n            link:           article.link\n        }"],[0,");\n "]],"start1":2467,"start2":2467,"length1":79,"length2":167},{"diffs":[[0,"    "],[1,"\n"],[0,"        "],[-1,"});\n            }\n        }"],[1,"a.save();\n    });\n};\n\nReader.getFeedArticles = function(feedId, callback){\n    console.log('reader.js:Reader.getFeedArticles:feedId=%s', feedId);\n    var Article = mongoose.model('Article');\n    Article.find({feedId: new mongoose.Types.ObjectId(feedId)}, callback"],[0,");\n}"]],"start1":2637,"start2":2637,"length1":43,"length2":280},{"diffs":[[0,";\n};\n\nReader.get"],[-1,"Feed"],[1,"New"],[0,"Articles = funct"]],"start1":2914,"start2":2914,"length1":36,"length2":35},{"diffs":[[0,"  });\n};"],[-1,""],[1,"\n\n"],[0,"\n\nexport"]],"start1":3126,"start2":3126,"length1":16,"length2":18}]],"length":3172,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364394591573,"patch":[[{"diffs":[[0,"les:');\n    "],[-1,""],[0,""],[1,"var arr;\n    "],[0,"articles.for"]],"start1":2236,"start2":2236,"length1":24,"length2":37},{"diffs":[[0," a.save("],[-1,");\n    }"],[1,"function(err, a){\n            if(err) console.error(err);\n            else arr.push(a);\n        });\n    });\n    callback(arr"],[0,");\n};\n\nR"]],"start1":2662,"start2":2662,"length1":24,"length2":140},{"diffs":[[0,"cles = function("],[-1,"url"],[1,"feedId"],[0,", callback){\n   "]],"start1":3066,"start2":3066,"length1":35,"length2":38},{"diffs":[[0,"    "],[-1,"feedparser.parseUrl(url,\n        function(error, meta, articles){\n            if(error) console.error(error);"],[1,"var Feed = mongoose.model('Feed');\n    Feed.findOne({feedId: new mongoose.Types.ObjectId(feedId)}, function(err, feed){\n        if(feed.xmlUrl !== null)\n            feedparser.parseUrl(feed.xmlUrl, function(err, meta, articles){"],[0,"\n   "]],"start1":3101,"start2":3101,"length1":117,"length2":236},{"diffs":[[0,"        "],[-1,"else"],[1,"   "],[0," callbac"]],"start1":3338,"start2":3338,"length1":20,"length2":19},{"diffs":[[0,"allback("],[1,"err, meta, "],[0,"articles"],[1,", feed"],[0,");\n    "],[1,"        });\n"],[0,"    });\n"]],"start1":3351,"start2":3351,"length1":31,"length2":60}]],"length":3451,"saved":false}
{"ts":1364394629525,"patch":[[{"diffs":[[0," feed){\n"],[1,"        if(err) throw err;\n"],[0,"        "]],"start1":3217,"start2":3217,"length1":16,"length2":43}]],"length":3478,"saved":false}
{"ts":1364394675419,"patch":[[{"diffs":[[0,"    "],[-1,"if(err) throw err"],[1,"console.log(feed)"],[0,";\n  "]],"start1":3229,"start2":3229,"length1":25,"length2":25}]],"length":3478,"saved":false}
{"ts":1364394766985,"patch":[[{"diffs":[[0,".model('Feed');\n"],[1,"    Feed.findById();\n    \n    \n"],[0,"    Feed.findOne"]],"start1":3124,"start2":3124,"length1":32,"length2":63}]],"length":3509,"saved":false}
{"ts":1364394788423,"patch":[[{"diffs":[[0,"indById("],[1,"new mongoose.Types.ObjectId(feedId), function(err, feed){\n        \n    }"],[0,");\n    \n"]],"start1":3150,"start2":3150,"length1":16,"length2":88}]],"length":3581,"saved":false}
{"ts":1364394797365,"patch":[[{"diffs":[[0,"d){\n"],[-1,"        \n    });\n    \n    \n    Feed.findOne({feedId: new mongoose.Types.ObjectId(feedId)}, function(err, feed){\n"],[0,"    "]],"start1":3212,"start2":3212,"length1":120,"length2":8}]],"length":3469,"saved":false}
{"ts":1364394838776,"patch":[[{"diffs":[[0," var arr"],[1," = new Array()"],[0,";\n    ar"]],"start1":2247,"start2":2247,"length1":16,"length2":30}]],"length":3483,"saved":false}
{"ts":1364395039234,"patch":[[{"diffs":[[0,"feedId)}"],[-1,", "],[1,")\n            .sort({date: 'desc'})\n            .exec("],[0,"callback"]],"start1":3038,"start2":3038,"length1":18,"length2":70}]],"length":3535,"saved":false}
{"ts":1364396462055,"patch":[[{"diffs":[[0,"desc'})\n"],[1,"            .limit(3)\n"],[0,"        "]],"start1":3074,"start2":3074,"length1":16,"length2":38}]],"length":3557,"saved":false}
{"ts":1364396480703,"patch":[[{"diffs":[[0,"'})\n"],[-1,"            .limit(3)\n"],[0,"    "]],"start1":3078,"start2":3078,"length1":30,"length2":8}]],"length":3535,"saved":false}
{"ts":1364396554371,"patch":[[{"diffs":[[0,"rticles:');\n"],[1,"    console.log('articles.length:%s', articles.length);\n"],[0,"    var arr "]],"start1":2232,"start2":2232,"length1":24,"length2":80}]],"length":3591,"saved":false}
{"ts":1364397323892,"patch":[[{"diffs":[[0,"a){\n"],[-1,"            if(err) console.error(err);\n            else arr.push(a);\n"],[0,"    "]],"start1":2754,"start2":2754,"length1":78,"length2":8}]],"length":3521,"saved":false}
{"ts":1364397434058,"patch":[[{"diffs":[[0,"     a.save("],[1,");\n    },"],[0,"function(err"]],"start1":2728,"start2":2728,"length1":24,"length2":33},{"diffs":[[0,"(err"],[-1,", a"],[0,"){\n    "],[-1,"    });\n    });\n"],[0,"    "]],"start1":2757,"start2":2757,"length1":34,"length2":15},{"diffs":[[0,"ack(arr)"],[1,"\n    })"],[0,";\n};\n\nRe"]],"start1":2777,"start2":2777,"length1":16,"length2":23}]],"length":3518,"saved":false}
{"ts":1364397552558,"patch":[[{"diffs":[[0,"ack(arr)"],[1,";"],[0,"\n    });"]],"start1":2777,"start2":2777,"length1":16,"length2":17}]],"length":3519,"saved":false}
{"ts":1364397635507,"patch":[[{"diffs":[[0," a.save("],[1,"function(err, a){\n            if(err) console.error(err);\n            else arr.push(a);\n        }"],[0,");\n    }"]],"start1":2732,"start2":2732,"length1":16,"length2":113},{"diffs":[[0,";\n    },"],[1," "],[0,"function"]],"start1":2838,"start2":2838,"length1":16,"length2":17}]],"length":3617,"saved":false}
{"ts":1364398283438,"patch":[[{"diffs":[[0,"});\n"],[-1,"    }, function(err){\n        callback(arr);\n"],[0,"    "]],"start1":2836,"start2":2836,"length1":53,"length2":8}]],"length":3572,"saved":false}
{"ts":1364398299651,"patch":[[{"diffs":[[0,"rray();\n"],[1,"    var endCount = 0;\n"],[0,"    arti"]],"start1":2319,"start2":2319,"length1":16,"length2":38}]],"length":3594,"saved":false}
{"ts":1364398322499,"patch":[[{"diffs":[[0,"else"],[-1," arr.push(a);"],[1,"{\n                arr.push(a);\n                endCount++;\n            }"],[0,"\n   "]],"start1":2832,"start2":2832,"length1":21,"length2":80}]],"length":3653,"saved":false}
{"ts":1364398357692,"patch":[[{"diffs":[[0,"ount++;\n"],[1,"                if(endCount == articles.length)\n                    callback(arr);\n"],[0,"        "]],"start1":2887,"start2":2887,"length1":16,"length2":99}]],"length":3736,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364399579582,"patch":[[{"diffs":[[0,"function(feedId,"],[1," limit,"],[0," callback){\n    "]],"start1":3041,"start2":3041,"length1":32,"length2":39}]],"length":3743,"saved":false}
{"ts":1364399736327,"patch":[[{"diffs":[[0,"', feedId);\n"],[1,"    if('number' != typeof limit){\n        limit = 30;\n    }\n"],[0,"    var Arti"]],"start1":3135,"start2":3135,"length1":24,"length2":84}]],"length":3803,"saved":false}
{"ts":1364399750929,"patch":[[{"diffs":[[0,"desc'})\n"],[1,"            .limit(limit)\n"],[0,"        "]],"start1":3342,"start2":3342,"length1":16,"length2":42}]],"length":3829,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364890942482,"patch":[[{"diffs":[[0,"length)\n"],[1,"                    if(typeof callback !== undefined)\n    "],[0,"        "]],"start1":2935,"start2":2935,"length1":16,"length2":74}]],"length":3887,"saved":false}
{"ts":1364891186107,"patch":[[{"diffs":[[0,"     if("],[-1,"typeof "],[0,"callback"]],"start1":2958,"start2":2958,"length1":23,"length2":16}]],"length":3880,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364902256708,"patch":[[{"diffs":[[0,"s);\n    });\n};\n\n"],[1,"Reader.addTag = function(tag, callback){\n    console.log('reader.js:Reader.addTag');\n    var Tag = mongoose.model('Tag');\n    var tag = new Tag({\n        name: tag.name\n    });\n    \n    tag.save();\n    \n};\n\n"],[0,"Reader.addFeed ="]],"start1":1216,"start2":1216,"length1":32,"length2":239}]],"length":4087,"saved":false}
{"ts":1364902324087,"patch":[[{"diffs":[[0,"ag.save("],[1,"function(err, t){\n        if(err) console.err(err);\n        else{\n            console.log('Success to save tag.');\n            if(callback !== undefined)\n                callback(t);\n        }\n    }"],[0,");\n    \n"]],"start1":1419,"start2":1419,"length1":16,"length2":214}]],"length":4285,"saved":false}
{"ts":1364902342151,"patch":[[{"diffs":[[0,"tion(tag"],[1,"name"],[0,", callba"]],"start1":1252,"start2":1252,"length1":16,"length2":20}]],"length":4289,"saved":false}
{"ts":1364902345634,"patch":[[{"diffs":[[0,"ame: tag"],[-1,"."],[0,"name\n   "]],"start1":1391,"start2":1391,"length1":17,"length2":16}]],"length":4288,"saved":false}
{"ts":1364902352922,"patch":[[{"diffs":[[0,"    });\n"],[-1,"    \n"],[0,"};\n\nRead"]],"start1":1623,"start2":1623,"length1":21,"length2":16}]],"length":4283,"saved":false}
{"contributors":[],"silentsave":false,"ts":1365055665776,"patch":[[{"diffs":[[0,"s);\n    });\n};\n\n"],[1,"Reader.loadTag = function(callback){\n    console.log('/modules/reader.js:Call Reader.loadTag');\n    \n}\n\n"],[0,"Reader.addTag = "]],"start1":1216,"start2":1216,"length1":32,"length2":136}]],"length":4387,"saved":false}
{"ts":1365055684059,"patch":[[{"diffs":[[0,"');\n    "],[1,"var Tag = mongoose.model('Tag');"],[0,"\n}\n\nRead"]],"start1":1324,"start2":1324,"length1":16,"length2":48}]],"length":4419,"saved":false}
{"ts":1365055735713,"patch":[[{"diffs":[[0,"'Tag');\n"],[1,"    Tag.find(function(err, tags){\n        if(err) throw err;\n    });\n"],[0,"}\n\nReade"]],"start1":1357,"start2":1357,"length1":16,"length2":85}]],"length":4488,"saved":false}
{"ts":1365055756602,"patch":[[{"diffs":[[0,"ow err;\n"],[1,"        else\n            if(callback !== undefined) callback(tags);\n"],[0,"    });\n"]],"start1":1418,"start2":1418,"length1":16,"length2":84}]],"length":4556,"saved":false}
{"ts":1365055766008,"patch":[[{"diffs":[[0,"   });\n}"],[1,";"],[0,"\n\nReader"]],"start1":1495,"start2":1495,"length1":16,"length2":17}]],"length":4557,"saved":false}
{"contributors":[],"silentsave":false,"ts":1365055810303,"patch":[[{"diffs":[[0,"ader.loadTag"],[1,"s"],[0," = function("]],"start1":1234,"start2":1234,"length1":24,"length2":25}]],"length":4558,"saved":false}
{"contributors":[],"silentsave":false,"ts":1365070257211,"patch":[[{"diffs":[[0,"s);\n    });\n};\n\n"],[1,"Reader.loadFeedTags = function(callback){\n    \n};\n\n"],[0,"Reader.addTag = "]],"start1":1491,"start2":1491,"length1":32,"length2":83}]],"length":4609,"saved":false}
{"ts":1365070323450,"patch":[[{"diffs":[[0,"ader.loadTag"],[1,"s"],[0,"');\n    var "]],"start1":1313,"start2":1313,"length1":24,"length2":25},{"diffs":[[0,"k){\n    "],[1,"console.log('/modules/reader.js:Call Reader.loadFeedTags');"],[0,"\n};\n\nRea"]],"start1":1546,"start2":1546,"length1":16,"length2":75}]],"length":4669,"saved":false}
{"ts":1365071072756,"patch":[[{"diffs":[[0,"Tags');\n"],[1,"    var Tag = mongoose.model('Tag');\n"],[0,"};\n\nRead"]],"start1":1606,"start2":1606,"length1":16,"length2":53}]],"length":4706,"saved":false}
{"ts":1365071280568,"patch":[[{"diffs":[[0,"});\n};\n\n"],[1,"Reader.updateFeedTags = function(feedId, feedTags){\n    var Feed = mongoose.model('Feed');\n    Feed.update();\n}\n\n"],[0,"\n\nexport"]],"start1":4662,"start2":4662,"length1":16,"length2":129}]],"length":4819,"saved":false}
{"ts":1365071501959,"patch":[[{"diffs":[[0,".update("],[1,"\n        {_id: new mongoose.Types.ObjectId(feedId)},\n        {feedTags: feedTags},\n        {safe: true},\n        function(err, numberAffected, raw){\n            \n        }"],[0,");\n}\n\n\n\n"]],"start1":4769,"start2":4769,"length1":16,"length2":187}]],"length":4990,"saved":false}
{"ts":1365071527200,"patch":[[{"diffs":[[0,"w){\n            "],[1,"if(err) console.error(err);"],[0,"\n        });\n}\n\n"]],"start1":4922,"start2":4922,"length1":32,"length2":59},{"diffs":[[0,"   });\n}"],[1,";"],[0,"\n\n\n\nexpo"]],"start1":4971,"start2":4971,"length1":16,"length2":17}]],"length":5018,"saved":false}
{"ts":1365071553480,"patch":[[{"diffs":[[0,"feedTags"],[1,", callback"],[0,"){\n    v"]],"start1":4711,"start2":4711,"length1":16,"length2":26},{"diffs":[[0,"ole.error(err);\n"],[1,"            else{\n                \n            }\n"],[0,"        });\n};\n\n"]],"start1":4960,"start2":4960,"length1":32,"length2":81}]],"length":5077,"saved":false}
{"ts":1365071602933,"patch":[[{"diffs":[[0,"\n               "],[-1," "],[1,"if(callback !== undefined){\n                   callback()\n               }"],[0,"\n            }\n "]],"start1":4993,"start2":4993,"length1":33,"length2":106}]],"length":5150,"saved":false}
{"ts":1365071618237,"patch":[[{"diffs":[[0,"            else"],[-1,"{"],[0,"\n               "]],"start1":4976,"start2":4976,"length1":33,"length2":32},{"diffs":[[0,"defined)"],[-1,"{"],[0,"\n       "]],"start1":5026,"start2":5026,"length1":17,"length2":16},{"diffs":[[0,"ck()"],[-1,"\n               }\n            }"],[1,";"],[0,"\n   "]],"start1":5060,"start2":5060,"length1":39,"length2":9}]],"length":5118,"saved":false}
{"ts":1365071629290,"patch":[[{"diffs":[[0,"defined)"],[-1,"\n                  "],[0," callbac"]],"start1":5026,"start2":5026,"length1":35,"length2":16}]],"length":5099,"saved":false}
