{"ts":1363955152147,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var feedparser = require('feedparser')\n    , mongoose = require('mongoose')\n    , schema   = require('./schema');\n    \nmongoose.connect('mongodb://localhost/rssreader');\n\nfunction Reader(){\n}\n\nReader.test = function(){\n  console.log('aaa');  \n};\n\nReader.read = function(){\n    feedparser.parseUrl('feeds.gawker.com/gizmodo/full',\n        function(error, meta, articles){\n            if(error) console.error(error);\n            else{\n                console.log('%s - %s - %s', meta.title, meta.link, meta.xmlUrl);\n                articles.forEach(function(article){\n                    console.log(\"%s - %s(%s)\", article.date, article.title, article.link);\n                });\n            }\n        });\n};\n\nReader.save = function(name){\n    var db = mongoose.connection;\n    db.on('error', console.error.bind(console, 'connection error:'));\n    db.once('open', function(){\n        var Feed = mongoose.model('Feed');\n        var feed = new Feed({name: name});\n        feed.save(function(){\n            console.log('success');\n        });\n    });\n};\n\nReader.load = function(callback){\n    console.log(\"Call Reader.load\");\n    var Feed = mongoose.model('Feed');\n    Feed.find(function(err, feeds){\n        callback(feeds);\n    });\n};\n\nReader.addFeed = function(url, callback){\n    feedparser.parseUrl(url,\n        function(error, meta, articles){\n            if(error) console.error(error);\n            else{\n                var Feed = mongoose.model('Feed');\n                var feed = new Feed({\n                    name: meta.title,\n                    link: meta.link,\n                    xmlUrl: meta.xmlUrl\n                });\n                \n                console.log('Add feed. %s - %s - %s', meta.title, meta.link, meta.xmlUrl);\n                \n                feed.save(function(){\n                    console.log('Success to save feed.');\n                    callback(feed);\n                });\n            }\n        });\n};\n\nReader.getFeedArticles = function(url, callback){\n    feedparser.parseUrl(url,\n        function(error, meta, articles){\n            if(error) console.error(error);\n            else callback(articles);\n        });\n};\n\nexports = module.exports = Reader;"]],"start1":0,"start2":0,"length1":0,"length2":2188}]],"length":2188}
{"contributors":[],"silentsave":false,"ts":1363956323693,"patch":[[{"diffs":[[0,"               \n"],[1,"                articles.forEach(function(article){\n                    feed.item.push(article);\n                });\n                \n"],[0,"                "]],"start1":1631,"start2":1631,"length1":32,"length2":166}]],"length":2322,"saved":false}
